<!DOCTYPE html>
<html lang="en">
    {% extends 'medrec/base.html' %}
    
    {% block content %}
    <head>
        <head>
            {% load crispy_forms_tags %}
            {% load static %}
            <meta charset="UTF-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Document</title>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
            <link rel="stylesheet" href="{% static 'css/base.css' %}">
            <link rel="stylesheet" href="{% static 'css/bill.css' %}">
            <link rel="stylesheet" href="{% static 'css/demo.css' %}">
            <link rel="stylesheet" href="{% static 'css/note.css' %}">
            <link rel="stylesheet" href="{% static 'css/plan.css' %}">
            <link rel="stylesheet" href="{% static 'css/s_o.css' %}">
            <link rel="stylesheet" href="{% static 'css/vital.css' %}">
            <script defer src="{% static 'js/app.js'%}"></script>
            
        </head>
        <body> 
        <div>
            <hr>
                    <p style="text-align:center"><span>Search Patient: 
                        <input type="text">
                        <input type="submit">
                    </span></p> 
                    <hr>
                    <h3 style="text-align:center;">Patients Demographic</h3>
                    <div class="demo">
                        
                        <div class="pt_pic">
                            <h1>Patient Picture</h1>
                            <button>Submit</button> <button>Update</button> <button>Add</button>
                        </div>
                        <div class="demo_info">
                            <h1>Demographic Information</h1>
                            I want an alert box when this is clicked
                            <button>Submit</button> <button>Update</button> <button>Add</button>
                        </div>
                        <div class="hedi_meas">
                            <h1>HEDIS Measures</h1>
                            <button>Submit</button> <button>Update</button> <button>Add</button>
                        </div>
                        <div class="chron_hx">
                            <h1>Chronic History</h1>
                            <button>Submit</button> <button>Update</button> <button>Add</button>
                        </div>
                    </div>
            <hr>
            <h3 style="text-align:center">Vital Signs</h3>
                    <div class="vital">
                        <div class="vit_sign">
                                <p>BP</p>
                                <p>Pulse</p> 
                                <p>Oxygen
                                RR 
                                Temp 
                                Pain 
                                HT
                                WT</p> 
                        </div>
                        <div class="ale_rt">
                                <p>AOO *3 --- dropdown selection</p>
                                <p>NAD --- Yes or No</p>
                                <p>Clear to Auscultation</p>
                        </div>
            
                        <div class="obser">
                            <p>Other Types of Observable Assessment</p>
                            <p>PERLA</p>
                            <p>Verbal</p>
                            
                        </div>
            
                    </div>
            <hr>
                    <h3 style="text-align:center;">Subjective and Objective</h3>
                    Make it where you select one, either S/O ------
                    Link SO to message, where PT can type own SO
                    <div class="s_o">
                        
                        <div class="subje_ct">
                            <h3>Subjective</h3>
                        </div>
                        <div class="obje_ct">
                            <h3>Observation</h3>
                        </div>
                    </div>
            <hr>
                    <div class="plan">
                        <div class="assessment_tabs">
                            <input type="radio" id="as_tab" name="assessment_tabs" checked="checked">
                            <label for="as_tab">Assessment</label>
                            <div class="tab">
                                <div id="app">
                                    <h1>Get Codes</h1>
                                    <form @submit.prevent="getCodes">
                                        <div>
                                            <input type="search" class="form-control" v-model="query" placeholder="Search ICD Codes">
                                            <button class="btn btn-success">Search</button>
                                        </div>
                                    </form>
                                    <form action="" id="code-form">
                                        <div class="row">
                                            {% csrf_token %}
                                            
                                            {% for field in form  %}
                                                <label class="col-12">{{field.label}}</label>
                                                {{field}}
                                            {% endfor %}
                                                <input type="submit" class="btn btn-success" value="Save Code" />
                                        </div>



                                        
                                    <table class="table table-striped table-sm" id="my_friends">
                                        <thead>
                                            <tr>
                                                <th>Diagnosis: </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                            {% for icdcodes in code_forms  %}
                                            <tr>
                                                <td>{{icdcodes.diagnosis}}</td>
                                            </tr>
                                                
                                            {% endfor %}
                                                
                                        </tbody>
                                    </table>

                                    </form>

                                    <form action="">
                                        
                                        <select name="" id="" @click="getCode()">
                                            <option v-for="(icd,index) in data" :key="index">
                                                [[icd]]
                                            </option>
                                        </select>
                                        <button onclick="myFunction([[index]])" class="btn btn-danger">Submit</button>
                                       
                                    </form>
                                       
                                </div>
                                        
                            </div>
                            <input type="radio" id="lab_tab" name="assessment_tabs">
                            <label for="lab_tab">Laboratory</label>
                            <div class="tab">
                                <h3>Laboratory</h3>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. A tempora inventore dolores magni, quaerat asperiores. Perferendis accusamus vitae, aspernatur modi earum voluptatum deserunt quod quaerat blanditiis tenetur alias cupiditate nulla.</p>
                            </div>
                    
                            <input type="radio" id="rad_tab" name="assessment_tabs">
                            <label for="rad_tab">Radiology</label>
                            <div class="tab">
                                <h3>Radiology</h3>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. A tempora inventore dolores magni, quaerat asperiores. Perferendis accusamus vitae, aspernatur modi earum voluptatum deserunt quod quaerat blanditiis tenetur alias cupiditate nulla.</p>
                            </div>
            
                            <input type="radio" id="phar_tab" name="assessment_tabs">
                            <label for="phar_tab">Pharmacy</label>
                            <div class="tab">
                                <h3>Pharmacy</h3>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. A tempora inventore dolores magni, quaerat asperiores. Perferendis accusamus vitae, aspernatur modi earum voluptatum deserunt quod quaerat blanditiis tenetur alias cupiditate nulla.</p>
                            </div>
            
                            <input type="radio" id="plan_tab" name="assessment_tabs">
                            <label for="plan_tab">Plan</label>
                            <div class="tab">
                                
                                <div>
                                    <p>Medical Problems</p>
                                    <div class="container-fluid">
                                        <form id="code-form">
                                            <div class="row">
                                                {% csrf_token %}
                                                {% for field in form %}
                                                <div class="form-group col-4">
                                                    <label class="col-12">{{ field.label }}</label>
                                                    {{ field }}
                                                </div>
                                                {% endfor %}
                                                <input type="submit" class="btn btn-primary" value="Create Fri" />
                                            </div>
                                        <form>
                                    </div>
                                    <hr />
                                    <div class="container-fluid">
                                        <table class="table table-striped table-sm" id="my_friends">
                                            <thead>
                                                <tr>
                                                    <th>Diagnosis</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            {% for icdcodes in code_forms %}
                                            <tr>
                                                <td>{{icdcodes.diagnosis}}</td>
                                                
                                            </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    
                                    </div>
                                </div>
                                <p>Laboratory</p>
                                <p>Radiology</p>
                                <p>Medications</p>
                                <p>Plan</p>
                            </div>
                        </div>
                    </div>
                    </div>
            <hr>
                    <div class="billing">
                        <h2 style="text-align: center;">Patients Bill</h2>
                        <form action="">
                            <p style="justify-content:space-around">
                                <label for="">Diagnosis:</label>
                                <input type="text" placeholder="Diagnosis">
                                <input type="number" placeholder="cost">
                                <button>Submit</button>
            
                                <label for="">Medication:</label>
                                <input type="text" placeholder="Medication">
                                <input type="number" placeholder="cost">
                                <button>Submit</button>
                            </p>
                            <p style="justify-content:space-around">
                                <label for="">Laboratory:</label>
                                <input type="text" placeholder="Laboratory">
                                <input type="number" placeholder="cost">
                                <button>Submit</button>
                                
                                <label for="">Radiology:</label>
                                <input type="text" placeholder="Radiology">
                                <input type="number" placeholder="cost">
                                <button>Submit</button>
                            </p>
                            <p>
                                <label for="">Total:</label>
                                <input type="number" placeholder="Total">
                            </p>
                            
                        </form>
                        <button class="btn btn-danger">Submit</button>
            
                    </div>
            
                </div>
        
                <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js" integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script>
                <script src='https://clinicaltables.nlm.nih.gov/autocomplete-lhc-versions/17.0.2/autocomplete-lhc.min.js'></script>
                <script>
                    var app = new Vue({
                        delimiters: ['[[',']]'],
                        el: '#app',
                        data() {
                            return {
                                query: '',
                                data:[]
                    }
                            
                        },
                        methods: {
                            async getCodes(){
                                await axios.get(`https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code,name&terms=${this.query}`)
                                .then((response)=>{
                                    this.data = response.data[3]
                                    console.log(this.data)
                                })
                                .catch((error)=>{
                                    console.log(error)
                                })
                            },
                            
        
                        },
                        

                        created: function() {
        
                        }
                    })
                </script>
                <script>
                    /*
                        On submiting the form, send the POST ajax
                        request to server and after successfull submission
                        display the object.
                    */
                    $("#code-form").submit(function (e) {
                        // preventing from page reload and default actions
                        e.preventDefault();
                        // serialize the data for sending the form data.
                        var serializedData = $(this).serialize();
                        // make POST ajax call
                        $.ajax({
                            type: 'POST',
                            url: "{% url 'post_code' %}",
                            data: serializedData,
                            success: function (response) {
                                // on successfull creating object
                                // 1. clear the form.
                                $("#code-form").trigger('reset');
                                // 2. focus to nickname input 
                                $("#id_diagnosis").focus();
                
                                // display the newly friend to table.
                                var instance = JSON.parse(response["instance"]);
                                var fields = instance[0]["fields"];
                                $("#my_friends tbody").prepend(
                                    `<tr>
                                    <td>${fields["diagnosis"]||""}</td>
                                    </tr>`
                                )
                            },
                            error: function (response) {
                                // alert the error if any error occured
                                alert(response["responseJSON"]["error"]);
                            }
                        })
                    })
                </script>
                
        
        
        </body>
        
        {% endblock content %}
        
</html>